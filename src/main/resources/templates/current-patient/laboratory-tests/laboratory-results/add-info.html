<!DOCTYPE html>
<html lang="en" layout:decorate="~{layouts/layoutcurrentpatient}"
      xmlns:layout="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="#{fragment.current.patient.navigation.left.laboratory.tests}">Laboratory tests</title>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.1/js/tempusdominus-bootstrap-4.min.js"></script>
    <script th:inline="javascript">
        /*<![CDATA[*/
        const map = [[${correlations}]];
        /*]]>*/

        $(document).ready(function () {
            var unit = "";
            document.getElementById("analysisName").addEventListener("change", setUnit);

            function setUnit() {
                document.getElementById("unitOfMeasurement").setAttribute("value", map[document.getElementById("analysisName").value]);
            }
        })
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.37/js/bootstrap-datetimepicker.min.js"
            th:src="@{/webjars/bootstrap-datetimepicker/2.4.4/js/bootstrap-datetimepicker.min.js}"></script>
</head>
<body>
<div layout:fragment="content">
    <div class="m-3"></div>
    <h2 th:text="#{fragment.current.patient.navigation.left.laboratory.tests.laboratory.results.observation.laboratory.add}">Add Laboratory Results information</h2>
    <div class="m-5"></div>
    <form action="#" th:action="@{/current-patient/laboratory-tests/laboratory-results/save-add}" th:object="${observationLaboratoryInfoCommandAnalysis}" method="post">
        <div th:if="${#fields.hasErrors('*')}" class="alert alert-danger">
            <p>Please correct the errors below</p>
        </div>
        <div class="form-row">
            <div class="col-md-6">
                <label for="analysisName" th:text="#{fragment.current.patient.navigation.laboratory.tests.laboratory.results.observation.laboratory.type}">Laboratory/ECHO</label>
                <select class="form-control" id="analysisName" th:field="*{analysisName}">
                    <option selected value="" th:text="#{fragment.current.patient.navigation.laboratory.tests.laboratory.results.observation.laboratory.choose}">Choose a type</option>
                    <option input type="text" class="form-control" th:each="type : ${laboratoryTypes}" th:classappend="${#fields.hasErrors('analysisName')} ? 'is-invalid' :''"
                            th:value="${type.getName()}" th:text="${type.getName()}">Analysis name</option>
                </select>
                <div class="invalid-feedback" th:if="${#fields.hasErrors('analysisName')}">
                    <ul>
                        <li th:each="err : ${#fields.errors('analysisName')}" th:text="${err}">err</li>
                    </ul>
                </div>
                <br>
            </div>

            <div class="col-md-6">
                <label for="localDateOfLaboratory" th:text="#{fragment.current.patient.navigation.laboratory.tests.laboratory.results.observation.laboratory.date}">Date:</label><br>
                <div class="input-group date" id="datetimepicker1" data-target-input="nearest">
                    <input type="text" class="form-control datetimepicker-input" data-target="#datetimepicker1"
                           th:field="*{observationLaboratoryInfoCommandSample.localDateOfLaboratory}" id="localDateOfLaboratory" placeholder="Date"/>
                    <div class="input-group-append" data-target="#datetimepicker1" data-toggle="datetimepicker">
                        <div class="input-group-text"><i class="fa fa-calendar-alt"></i></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="form-row">
            <div class="col-md-6">
                <label for="currentValue" th:text="#{fragment.current.patient.navigation.laboratory.tests.laboratory.results.observation.laboratory.value}">Value </label><br>
                <input id="currentValue" type="number" step="0.01" class="form-control"
                       th:classappend="${#fields.hasErrors('observationLaboratoryInfoCommandSample.currentValue')} ? 'is-invalid' :''"
                       th:field="*{observationLaboratoryInfoCommandSample.currentValue}">
                <div class="invalid-feedback" th:if="${#fields.hasErrors('observationLaboratoryInfoCommandSample.currentValue')}">
                    <ul>
                        <li th:each="err : ${#fields.errors('observationLaboratoryInfoCommandSample.currentValue')}" th:text="${err}">err</li>
                    </ul>
                </div>
            </div>

            <div class="col-md-6">
                <label for="unitOfMeasurement" th:text="#{fragment.current.patient.navigation.laboratory.tests.laboratory.results.observation.laboratory.unit}">Unit of Measurement</label><br>
                <input style="pointer-events: none; opacity: 0.8; background-color: lightgray" id="unitOfMeasurement" type="text" class="form-control" th:field="*{observationLaboratoryInfoCommandSample.unitOfMeasurement}">
            </div>
        </div></br>

        <div class="text-right"><br>
            <button type="submit" class="btn btn-primary" th:text="#{button.save}">Save</button>
        </div>
    </form>
</div>

<script>
    $.fn.datetimepicker.Constructor.Default = $.extend({}, $.fn.datetimepicker.Constructor.Default, {
        icons: {
            time: 'far fa-clock',
            date: 'far fa-calendar',
            up: 'fas fa-arrow-up',
            down: 'fas fa-arrow-down',
            previous: 'fas fa-chevron-left',
            next: 'fas fa-chevron-right',
            today: 'far fa-calendar-check-o',
            clear: 'far fa-trash',
            close: 'far fa-times'
        }
    });

    $('#datetimepicker1').datetimepicker({
        format: 'dd-MM-yyyy h:mm a'
    });
</script>

</body>
</html>