<!DOCTYPE html>
<html lang="en" layout:decorate="~{layouts/layoutcurrentpatient}"
      xmlns:layout="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="#{fragment.current.patient.navigation.left.hospital.discharge.report}">Hospital Discharge
        Report</title>
</head>

<body>
<div layout:fragment="content">
    <!--    <h3 th:text="#{fragment.current.patient.navigation.left.hospital.discharge.report}">Hospital Discharge Report</h3>-->
    <div class="m-5"></div>
    <div class="alert alert-success" role="alert" id="message1" th:if="${savedToCloud != null && savedToCloud}"
         th:text="#{fragment.current.patient.navigation.left.hospital.discharge.report.data.saved}">Data uploaded in
        Citizen Cloud
    </div>
    <script>
        setTimeout(function () {
            $('#message1').remove();
        }, 5000);
    </script>
    <div class="alert alert-danger" role="alert" id="message2" th:if="${savedToCloud != null && savedToCloud == false}"
         th:text="#{alert.error}">Error
    </div>
    <script>
        setTimeout(function () {
            $('#message2').remove();
        }, 5000);
    </script>

    <form class="row justify-content-center" th:action="@{/current-patient/hospital-discharge-report/save}"
          th:object="${hospitalDischargeReportCommand}" method="post">
        <br>

        <div class="form-group col-12">
            <label for="reason" th:text="#{fragment.current.patient.navigation.left.hospital.discharge.report.reason}">Reason of admission:</label>
            <textarea class="form-control" id="reason" rows="3" type="input" name="reason" th:field="*{reasons}"></textarea>
        </div>
        <div class="form-group col-12">
            <label for="finding" th:text="#{fragment.current.patient.navigation.left.hospital.discharge.report.significant.findings}">Discharge diagnostic assessment:</label>
            <textarea class="form-control" id="finding" rows="3" type="input" name="finding" th:field="*{findings}"></textarea>
        </div>
        <div class="form-group col-12">
            <label for="procedure" th:text="#{fragment.current.patient.navigation.left.hospital.discharge.report.procedures.and.treatment}">Instrumental examinations reports:</label>
            <textarea class="form-control" id="procedure" rows="3" type="input" name="procedure" th:field="*{procedures}"></textarea>
        </div>
        <div class="form-group col-12">
            <label for="condition" th:text="#{fragment.current.patient.navigation.left.hospital.discharge.report.discharge.conditions}">Future visits and recommendations:</label>
            <textarea class="form-control" id="condition" rows="3" type="input" name="condition" th:field="*{conditions}"></textarea>
        </div>
        <div class="form-group col-12">
            <label for="instruction" th:text="#{fragment.current.patient.navigation.left.hospital.discharge.report.patient.family.instructions}">Therapy and prescriptions:</label>
            <textarea class="form-control" id="instruction" rows="3" type="input" name="instruction" th:field="*{instructions}"></textarea>
        </div>

        <br>
        <div class="m-3"></div>
        <p th:if="${!hospitalDischargeReportCommand.getPrescriptionService().getPrescriptionRepository().findAll().isEmpty()}">
            <br>
        <h4 th:if="${!hospitalDischargeReportCommand.getPrescriptionService().getPrescriptionRepository().findAll().isEmpty()}"
            th:text="#{fragment.current.patient.navigation.left.current.medications.prescription.medication.prescription.to.upload.in.citizen.cloud}">Prescription to upload in Citizen Cloud</h4></p>
        <table id="uploadCloud" class="table table-bordered"
               th:if="${!hospitalDischargeReportCommand.getPrescriptionService().getPrescriptionRepository().findAll().isEmpty()}">
            <thead class="thead-light">
            <tr>
                <th th:text="#{fragment.current.patient.navigation.left.current.medications.prescription.medication.drug.name}">Drug Name
                </th>
                <th th:text="#{fragment.current.patient.navigation.left.current.medications.prescription.medication.drug.dosage}">Drug Dosage
                </th>
                <th th:text="#{fragment.current.patient.navigation.left.current.medications.prescription.medication.timings}">Timings
                </th>
                <th th:text="#{fragment.current.patient.navigation.left.current.medications.prescription.medication.status}">Status
                </th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="prCloud : ${hospitalDischargeReportCommand.getPrescriptionService().getPrescriptionRepository().findAll()}">
                <td th:text="${prCloud.getDrugName()}"></td>
                <td th:text="${prCloud.getDrugDosage()}"></td>
                <td th:utext="${prCloud.getTimings()} + ' ' + #{fragment.current.patient.navigation.left.current.medications.prescription.medication.times.per.day}"></td>
                <td>
                    <th:block th:switch="${prCloud.getStatus().toLowerCase()}">
                        <div th:case="'active'">
                            <p th:text="#{fragment.current.patient.navigation.left.current.medications.prescription.medication.active}">Activ</p>
                        </div>
                        <div th:case="'onhold'">
                            <p th:text="#{fragment.current.patient.navigation.left.current.medications.prescription.medication.on.hold}">On-Hold</p>
                        </div>
                        <div th:case="'stopped'">
                            <p th:text="#{fragment.current.patient.navigation.left.current.medications.prescription.medication.stopped}">Stopped</p>
                        </div>
                    </th:block>
                </td>
            </tr>
            </tbody>
        </table>

        <br>
        <p th:if="${!hospitalDischargeReportCommand.getVitalSignsService.vitalSignsUpload().getVitalSignsInfoCommands().isEmpty()}">
        <h4 th:if="${!hospitalDischargeReportCommand.getVitalSignsService.vitalSignsUpload().getVitalSignsInfoCommands().isEmpty()}"
            th:text="#{fragment.current.patient.navigation.left.visit.data.vital.signs.to.upload.in.sehr}">Vital Signs to upload in S-EHR</h4></p>
        <table class="table table-bordered" th:if="${!hospitalDischargeReportCommand.getVitalSignsService.vitalSignsUpload().getVitalSignsInfoCommands().isEmpty()}">
            <thead class="thead-light">
            <tr>
                <th th:text="#{fragment.current.patient.navigation.left.visit.data.vital.signs.analysis}">Analysis</th>
                <th:block th:each="sample : ${hospitalDischargeReportCommand.getVitalSignsService.vitalSignsUpload().localDateTimeListWithoutDuplicates()}">
                    <th th:text="${{sample}}"></th>
                </th:block>
            </tr>
            </thead>
            <tbody>
            <tr th:each="an : ${hospitalDischargeReportCommand.getVitalSignsService.vitalSignsUpload().vitalSignsAnalysesWithoutDuplicates()}">
                <div th:with="map=${hospitalDischargeReportCommand.getVitalSignsService.vitalSignsUpload().valueReturn()}">
                    <td th:text="${{an}}"></td>
                    <th:block th:each="sample : ${hospitalDischargeReportCommand.getVitalSignsService.vitalSignsUpload().localDateTimeListWithoutDuplicates()}">
                        <td th:if="${map.get(an,sample) == null}">-</td>
                        <div th:if="${map.get(an,sample) != null}">
                            <td th:text="${{map.get(an,sample)}}"></td>
                        </div>

                    </th:block>
                </div>
            </tr>
            </tbody>
        </table>

        <br>
        <h4 th:if="${!hospitalDischargeReportCommand.getCurrentDiseaseService().listNewCurrentDiseases().isEmpty()}"
            th:text="#{fragment.current.patient.navigation.left.current.diseases.to.upload.in.sehr}">Current Diseases to upload in S-EHR</h4></p>
        <table class="table table-bordered"
               th:if="${!hospitalDischargeReportCommand.getCurrentDiseaseService().listNewCurrentDiseases().isEmpty()}">
            <thead class="thead-light">
            <tr>
                <th th:text="#{fragment.current.patient.navigation.left.current.diseases.disease}">disease</th>
                <th th:text="#{fragment.current.patient.navigation.left.current.diseases.disease.translated}">disease translated</th>
                <th th:text="#{fragment.current.patient.navigation.left.current.diseases.date.of.diagnosis}">date of diagnosis</th>
                <th th:text="#{fragment.current.patient.navigation.left.current.diseases.end.date.of.diagnosis}">end date of diagnosis</th>
            </tr>
            </thead>
            <tbody>
            <div th:each="currentDiseaseConclusion : ${hospitalDischargeReportCommand.getCurrentDiseaseService().listNewCurrentDiseases()}">
                <tr>
                    <td th:text="${{currentDiseaseConclusion.getDisease()}}">disease</td>
                    <th style="background-color: azure" th:text="${{currentDiseaseConclusion.getDiseaseTranslated()}}">disease translated</th>
                    <td th:text="${{#temporals.format(currentDiseaseConclusion.getDateOfDiagnosis(), 'dd-MM-yyyy')}}">date of diagnosis</td>
                    <td th:text="${{#temporals.format(currentDiseaseConclusion.getEndDateOfDiagnosis(), 'dd-MM-yyyy')}}">end date of diagnosis</td>
                </tr>
            </div>
            </tbody>
        </table>


        <br>
        <h4 th:if="${!hospitalDischargeReportCommand.getAllergyService().listOfNewAllergies().isEmpty()}"
            th:text="#{fragment.current.patient.navigation.left.allergies.to.upload}">Allergies to upload in S-EHR</h4></p>
        <table class="table table-bordered" th:if="${!hospitalDischargeReportCommand.getAllergyService().listOfNewAllergies().isEmpty()}">
            <thead class="thead-light">
            <tr>
                <th th:text="#{fragment.current.patient.navigation.left.allergies.name}">Name</th>
                <th th:text="#{fragment.current.patient.navigation.left.allergies.name.translated}">Name translated</th>
<!--                <th th:text="#{fragment.current.patient.navigation.left.allergies.category}">Category</th>-->
                <th th:text="#{fragment.current.patient.navigation.left.allergies.type}">Type</th>
                <th th:text="#{fragment.current.patient.navigation.left.allergies.symptoms}">Symptoms</th>
                <th th:text="#{fragment.current.patient.navigation.left.allergies.comments}">Comments</th>
                <th th:text="#{fragment.current.patient.navigation.left.allergies.end.date}">End date</th>
<!--                <th th:text="#{crud.button.actions}">Actions</th>-->
            </tr>
            </thead>
            <tbody>
            <div th:each="ai : ${hospitalDischargeReportCommand.getAllergyService().listOfNewAllergies()}">
                <tr>
                    <td th:text="${{ai.name}}"></td>
                    <th style="background-color: azure" th:text="${{ai.getNameTranslated()}}"></th>
<!--                    <td>-->
<!--                        <th:block th:switch="${ai.getCategory().toUpperCase()}">-->
<!--                            <div th:case="'BIOLOGIC'">-->
<!--                                <p th:text="#{fragment.current.patient.navigation.left.allergies.chooose.BIOLOGIC}">BIOLOGIC</p>-->
<!--                            </div>-->
<!--                            <div th:case="'ENVIRONMENT'">-->
<!--                                <p th:text="#{fragment.current.patient.navigation.left.allergies.chooose.ENVIRONMENT}">ENVIRONMENT</p>-->
<!--                            </div>-->
<!--                            <div th:case="'FOOD'">-->
<!--                                <p th:text="#{fragment.current.patient.navigation.left.allergies.chooose.FOOD}">FOOD</p>-->
<!--                            </div>-->
<!--                            <div th:case="'MEDICATION'">-->
<!--                                <p th:text="#{fragment.current.patient.navigation.left.allergies.chooose.MEDICATION}">MEDICATION</p>-->
<!--                            </div>-->
<!--                        </th:block>-->
<!--                    </td>-->
                    <td>
                        <th:block th:switch="${ai.getType().toUpperCase()}">
                            <div th:case="'ALLERGY'">
                                <p th:text="#{fragment.current.patient.navigation.left.allergies.chooose.ALLERGY}">ALLERGY</p>
                            </div>
                            <div th:case="'INTOLERANCE'">
                                <p th:text="#{fragment.current.patient.navigation.left.allergies.chooose.INTOLERANCE}">INTOLERANCE</p>
                            </div>
                        </th:block>
                    </td>
                    <td th:text="${{ai.getSymptoms()}}"></td>
                    <td th:text="${{ai.getComments()}}"></td>
                    <td th:text="${{#temporals.format(ai.getEndDate(), 'dd-MM-yyyy')}}"></td>
<!--                    <td>-->
<!--                        <div class="btn-group" role="group">-->
<!--                            <a href="#" class="btn btn-info"-->
<!--                               th:href="@{/current-patient/allergies/open-update-page-data-s-ehr(id=${{ai.getIdFHIR()}})}"-->
<!--                               th:text="#{crud.button.edit}">Edit</a>-->
<!--                        </div>-->
<!--                    </td>-->
                </tr>
            </div>
            </tbody>
        </table>
        <br>

        <br>
        <h4 th:if="${!hospitalDischargeReportCommand.getDiagnosticConclusionService().getNewConclusion().isEmpty()}"
            th:text="#{fragment.current.patient.navigation.left.conclusion.to.upload.in.sehr}">Diagnostic Conclusion to upload in S-EHR</h4></p>
        <table class="table table-bordered" th:if="${!hospitalDischargeReportCommand.getDiagnosticConclusionService().getNewConclusion().isEmpty()}">
            <thead class="thead-light">
            <tr>
                <th th:text="#{fragment.current.patient.navigation.left.conclusion.conclusion}">Conclusion</th>
                <th th:text="#{fragment.current.patient.navigation.left.conclusion.treatment.plan}">Treatment plan</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="concTrat : ${hospitalDischargeReportCommand.getDiagnosticConclusionService().getNewConclusion()}">
                <td th:text="${{concTrat.getConclusionNote()}}"></td>
                <td th:text="${{concTrat.getTreatmentPlan()}}"></td>
            </tr>
            </tbody>
        </table>

        <br>
        <h4 th:if="${!hospitalDischargeReportCommand.getPhExamService().getNewPhExam().isEmpty()}"
            th:text="#{fragment.current.patient.navigation.left.ph.exam.clinical.exam.upload.in.sehr}">Physical Examination to upload in S-EHR</h4></p>
        <table class="table table-bordered" th:if="${!hospitalDischargeReportCommand.getPhExamService().getNewPhExam().isEmpty()}">
            <thead class="thead-light">
            <tr>
                <th th:text="#{fragment.current.patient.navigation.left.ph.exam.clinical.exam}">Clinical exam</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="examination : ${hospitalDischargeReportCommand.getPhExamService().getNewPhExam()}">
                <td th:text="${{examination.getPhExam()}}"></td>
            </tr>
            </tbody>
        </table>

        <br>
        <h5 th:if="${!hospitalDischargeReportCommand.getObservationLaboratoryService().laboratoryUpload().getObservationLaboratoryInfoCommandAnalyses().isEmpty()}"
            th:text="#{fragment.current.patient.navigation.laboratory.tests.laboratory.results.observation.laboratory.add}">Laboratory Tests to upload in S-EHR</h5></p>
        <table class="table table-bordered" th:if="${!hospitalDischargeReportCommand.getObservationLaboratoryService().laboratoryUpload().getObservationLaboratoryInfoCommandAnalyses().isEmpty()}">
            <thead class="thead-light">
            <tr>
                <th th:text="#{fragment.current.patient.navigation.left.visit.data.vital.signs.analysis}">Analysis</th>
                <th:block th:each="sample : ${hospitalDischargeReportCommand.getObservationLaboratoryService().laboratoryUpload().localDateTimeListWithoutDuplicatesLab()}">
                    <th th:text="${{sample}}"></th>
                </th:block>
            </tr>
            </thead>
            <tbody>
            <tr th:each="an : ${hospitalDischargeReportCommand.getObservationLaboratoryService().laboratoryUpload().laboratoryAnalysesWithoutDuplicates()}">
                <div th:with="map=${hospitalDischargeReportCommand.getObservationLaboratoryService().laboratoryUpload().valueReturnLaboratory()}">
                    <td th:text="${{an}}"></td>
                    <th:block th:each="sample : ${hospitalDischargeReportCommand.getObservationLaboratoryService().laboratoryUpload().localDateTimeListWithoutDuplicatesLab()}">
                        <!--                    <td th:if="${map.get(an,sample) == null}">-</td>-->
                        <div th:if="${map.get(an,sample) != null}">
                            <td th:text="${{map.get(an,sample)}}"></td>
                        </div>

                    </th:block>
                </div>
            </tr>
            </tbody>
        </table>

        <br>
        <h5 th:if="${!hospitalDischargeReportCommand.getReasonService().getNewReason().isEmpty()}"
            th:text="#{fragment.current.patient.navigation.left.reason.reason.upload.in.sehr}">Reason to upload in S-EHR</h5></p>
        <table class="table table-bordered" th:if="${!hospitalDischargeReportCommand.getReasonService().getNewReason().isEmpty()}">
            <thead class="thead-light">
            <tr>
                <th th:text="#{fragment.current.patient.navigation.left.reason}">Reason</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="reason : ${hospitalDischargeReportCommand.getReasonService().getNewReason()}">
                <td th:text="${{reason.getSymptom()}}"></td>
            </tr>
            </tbody>
        </table>

        <div class="btn-group">
            <button type="submit" class="btn btn-primary" th:text="#{button.save}">Save</button>
            <a class="btn btn-outline-primary" th:href="@{/reports/hospital-discharge-report-pdf}"
               th:if="${hospitalDischargeReportCommand.hasData() || hasPrescriptions || hasVitalSigns || hasCurrentDiseases || hasAllergies || hasDiagnosticConclusion || hasPhExam || hasReason}"
               th:text="#{fragment.current.patient.navigation.left.outpatient.report.generate.pdf}">Generate PDF</a>
            <a class="btn btn-warning" th:href="@{/current-patient/hospital-discharge-report/save-in-cloud}"
               th:if="${hospitalDischargeReportCommand.hasData() || hasPrescriptions || hasVitalSigns || hasCurrentDiseases || hasAllergies  || hasDiagnosticConclusion || hasPhExam || hasReason}"
               th:text="#{fragment.current.patient.navigation.left.hospital.discharge.report.save.in.cloud}">Upload in
                Citizen Cloud</a>
        </div>
        <br>
    </form>
    <br>
</div>
</body>
</html>