<!DOCTYPE html>
<html lang="en" layout:decorate="~{layouts/layoutcurrentpatient}"
      xmlns:layout="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="#{fragment.current.patient.navigation.left.current.diseases}">Current Diseases</title>
</head>

<body>
<div layout:fragment="content">
    <script>
        function autoRefresh() {
            window.location = window.location.href;
        }
        setInterval('autoRefresh()', 15000);
    </script>

<!--    <br/>-->
<!--    <div class="alert alert-success" role="alert" id="message1"> Data will appear on the screen after the request. Please wait! </div>-->
<!--    <script>-->
<!--        setTimeout(function () {-->
<!--            $('#message1').remove();-->
<!--        }, 5000);-->
<!--    </script>-->
    <div class="m-5"></div>
    <!--    <div class="btn-toolbar float-right" role="toolbar">-->
    <!--        <div class="btn-group btn-group-sm mr-2" role="group">-->
    <!--            <div class="btn-group mr-2" role="group">-->
    <!--                <a href="#" class="btn disabled" style="background-color: lightgray" th:text="#{ips.translate.label}">language of the section</a>-->
    <!--                <a href="#" class="btn btn-primary" th:styleappend="${!currentDiseaseCommand.getDisplayTranslatedVersion()} ? 'background-color: darkblue' : ''" th:href="@{/current-patient/switch-display-language(displayTranslatedVersion='false', redirect-to='/current-patient/current-diseases/view-section')}" th:text="#{ips.translate.button.original}">Initial version</a>-->
    <!--                <a href="#" class="btn btn-primary" th:styleappend="${currentDiseaseCommand.getDisplayTranslatedVersion()} ? 'background-color: darkblue' : ''"  th:href="@{/current-patient/switch-display-language(displayTranslatedVersion='true', redirect-to='/current-patient/current-diseases/view-section')}" th:text="#{ips.translate.button.translated}">Translated version</a>-->
    <!--            </div>-->
    <!--        </div>-->
    <!--    </div>-->
    <h3 th:text="#{fragment.current.patient.navigation.left.current.diseases}">Current Diseases</h3>
    <br>
    <div class="alert alert-danger" role="alert"
         th:if="${currentDiseaseDeletedFromSEHR != null && currentDiseaseDeletedFromSEHR}"
         th:text="#{fragment.current.patient.navigation.left.current.disease.deleted}">Current Disease deleted
    </div>
    <table class="table table-bordered" th:if="${!currentDiseaseCommand.getCurrentDiseaseInfoCommand().isEmpty()}">
        <thead class="thead-light">
        <tr>
            <!--                        <th th:text="#{template.current.patient.currentDisease.list.statement.code}">code</th>-->
            <th th:text="#{fragment.current.patient.navigation.left.current.diseases.disease}">disease</th>
            <th th:text="#{fragment.current.patient.navigation.left.current.diseases.disease.translated}">disease translated</th>
            <th th:text="#{fragment.current.patient.navigation.left.current.diseases.date.of.diagnosis}">date of diagnosis</th>
            <th th:text="#{fragment.current.patient.navigation.left.current.diseases.end.date.of.diagnosis}">end date of diagnosis</th>
<!--            <th th:text="#{fragment.current.patient.navigation.left.current.diseases.comment}">comment</th>-->
            <th th:text="#{crud.button.actions}">Actions</th>
        </tr>
        </thead>
        <tbody>
        <div th:each="currentDisease : ${currentDiseaseCommand.getCurrentDiseaseInfoCommand()}">
            <tr>
                <!--                        <td style="background-color: azure" th:style="${!currentDiseaseCommand.getDisplayTranslatedVersion()} ? '' : 'background-color: azure'" th:text="${currentDisease.getCode()}">code</td>-->
                <td th:text="${{currentDisease.getDisease()}}">disease</td>
                <th style="background-color: azure" th:text="${{currentDisease.getDiseaseTranslated()}}">disease translated</th>
                <td th:text="${{#temporals.format(currentDisease.getDateOfDiagnosis(), 'dd-MM-yyyy')}}">date of diagnosis</td>
                <td th:text="${{#temporals.format(currentDisease.getEndDateOfDiagnosis(), 'dd-MM-yyyy')}}">end date of diagnosis</td>
<!--                <td th:text="${currentDisease.getComment()}">comment</td>-->
                <td>
                    <div class="btn-group" role="group">
                        <a href="#" class="btn btn-info"
                           th:href="@{/current-patient/current-diseases/open-update-page(id=${currentDisease.getIdFHIR()})}"
                           th:text="#{crud.button.edit}">Edit</a>
                        <!--                        <a href="#" class="btn btn-danger"-->
                        <!--                           th:href="@{/current-patient/current-diseases/delete-current-disease(id=${currentDisease.getIdFHIR()})}"-->
                        <!--                           th:text="#{crud.button.delete}">Delete</a>-->
                    </div>
                </td>
            </tr>
        </div>
        </tbody>
    </table>

    <div class="m-5"></div>
    <div class="alert alert-danger" role="alert"
         th:if="${currentDiseaseDeletedFromDataBase != null && currentDiseaseDeletedFromDataBase}"
         th:text="#{fragment.current.patient.navigation.left.current.disease.deleted}">Current Disease deleted
    </div>
    <table class="table table-bordered" th:if="${!currentDiseasesList.isEmpty()}">
        <h5 th:text="#{fragment.current.patient.navigation.left.current.diseases.to.upload.in.sehr}">Current Diseases to
            upload in S-EHR</h5></p>
        <thead class="thead-light">
        <tr>
            <!--                        <th th:text="#{template.current.patient.currentDisease.list.statement.code}">code</th>-->
            <th th:text="#{fragment.current.patient.navigation.left.current.diseases.disease}">disease</th>
            <th th:text="#{fragment.current.patient.navigation.left.current.diseases.date.of.diagnosis}">date of diagnosis</th>
            <th th:text="#{fragment.current.patient.navigation.left.current.diseases.end.date.of.diagnosis}">end date of diagnosis</th>
<!--            <th th:text="#{fragment.current.patient.navigation.left.current.diseases.comment}">comment</th>-->
            <th th:text="#{crud.button.actions}">Actions</th>
        </tr>
        </thead>
        <tbody>
        <div th:each="currentDiseaseNew : ${currentDiseasesList}">
            <tr>
                <!--                        <td style="background-color: azure" th:style="${!currentDiseaseCommand.getDisplayTranslatedVersion()} ? '' : 'background-color: azure'" th:text="${currentDisease.getCode()}">code</td>-->
                <td th:text="${currentDiseaseNew.getDisease()}">disease</td>
                <td th:text="${{#temporals.format(currentDiseaseNew.getDateOfDiagnosis(), 'dd-MM-yyyy')}}">date of diagnosis</td>
                <td th:text="${{#temporals.format(currentDiseaseNew.getEndDateOfDiagnosis(), 'dd-MM-yyyy')}}">end date of diagnosis</td>
<!--                <td th:text="${currentDiseaseNew.getComment()}">comment</td>-->
                <td>
                    <div class="btn-group" role="group">
                        <a href="#" class="btn btn-info"
                           th:href="@{/current-patient/current-diseases/open-update-page-data-base(id=${currentDiseaseNew.getId()})}"
                           th:text="#{crud.button.edit}">Edit</a>
                        <a href="#" class="btn btn-danger"
                           th:href="@{/current-patient/current-diseases/delete-current-disease-from-db(id=${currentDiseaseNew.getId()})}"
                           th:text="#{crud.button.delete}">Delete</a>
                    </div>
                </td>
            </tr>
        </div>
        </tbody>
    </table>

    <div class="row justify-content-end" th:if="${session.emergency != null && session.emergency.equalsIgnoreCase('EMERGENCY')}">
        <a class="btn btn-primary" th:href="@{/current-patient/current-diseases/refresh-data}"
           th:text="#{fragment.current.patient.navigation.left.diagnostic.imaging.Image.Report.refresh.data.cloud}">Download data from Cloud</a>
    </div>
    <br>

    <div class="btn-toolbar float-right" role="toolbar" th:if="${patient != null}">
        <div class="btn-group" role="group">
            <a href="#" class="btn btn-primary" th:href="@{/current-patient/current-diseases/open-add-page}"
               th:text="#{crud.button.add}">Add</a>
        </div>
    </div>
    <br><br>

    <table id="uploadTable" class="table table-bordered" th:if="${!notes.isEmpty()}">
        <thead class="thead-light">
        <tr>
            <th th:text="#{fragment.current.patient.navigation.left.current.diseases.notes}">Notes</th>
            <th th:text="#{button.action}">Action</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="note : ${notes}">
            <td class="col-10" th:text="${note}"></td>
            <td>
                <div class="btn-group" role="group">
                    <a href="#" class="btn btn-primary"
                       th:href="@{/current-patient/current-diseases/delete(note=${note})}"
                       th:text="#{crud.button.delete}">Delete</a>
                </div>
            </td>
        </tr>
        </tbody>
    </table>

    <div class="row justify-content-end" th:if="${session.medicalVisit != null && session.medicalVisit.equalsIgnoreCase('OUTPATIENT_VISIT') }">
        <a class="btn btn-primary" th:href="@{/current-patient/current-diseases/refresh}"
           th:text="#{fragment.current.patient.navigation.left.diagnostic.imaging.Image.Report.refresh.data}">Download data from S-EHR</a>
    </div>

    <br><br>
    <form th:action="@{/current-patient/current-diseases/save-note}" method="post">
        <div class="form-group">
            <label for="note" th:text="#{fragment.current.patient.navigation.left.current.diseases.notes}">Notes</label>
            <textarea class="form-control" rows="3" type="input" name="note" id="note"></textarea>
        </div>
        <button type="submit" class="btn btn-primary mb-2" th:text="#{button.save}">Save</button>
    </form>
</div>
</body>
</html>